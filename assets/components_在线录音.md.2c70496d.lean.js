import{d as f,r as i,m as R,o as q,a as u,c as C,b as y,t as x,l as h,q as m,j as g,_ as B,h as S,i as k,w as b,s as M,k as _}from"./app.8e593f3f.js";const N=class{constructor(a){this.isDebugger=!1,this.mediaRecorder="",this.mediaStreamSource=null,this.audioCtx=null,this.analyser=null,this.stopDraw=!0;const{barWidth:s=3,baseLine:n=3,canvas:o="",color:l="#fff",space:t=3,type:e="audio/mp3",option:p={},onstop:r={},onstart:D={},onerror:c={},isDebugger:F=!1}=a;this.barWidth=s,this.baseLine=n,this.canvas=o,this.color=l,this.space=t,this.type=e,this.option=p,this.onstop=r,this.onstart=D,this.onerror=c,this.isDebugger=F}log(...a){this.isDebugger&&console.log(...a)}visualize(a){this.audioCtx.createMediaStreamSource(a).connect(this.analyser),this.analyser.fftSize=256,this.analyser.connect(this.audioCtx.destination);const n=document.querySelector(this.canvas),{clientWidth:o,clientHeight:l}=n;n.width=o,n.height=l;const t=Math.floor(o/(this.barWidth+this.space)),e=n.getContext("2d"),p=()=>{if(e.clearRect(0,0,o,l),this.stopDraw)return;const r=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(r);let D=0;e.fillStyle=this.color;for(let c=0;c<t;c++){const F=r[c]/256*l||this.baseLine,A=l/2-F/2;e.fillRect(D,A,this.barWidth,F),D+=this.barWidth+this.space}window.requestAnimationFrame(p)};p()}initMediaDevices(){return!!navigator.mediaDevices&&!!navigator.mediaDevices.getUserMedia&&!!window.MediaRecorder}initRecording(){navigator.mediaDevices.getUserMedia(this.option).then(a=>{const s=[];if(this.mediaRecorder=new MediaRecorder(a),this.canvas){this.stopDraw=!1;try{this.audioCtx=new window.AudioContext,this.analyser=this.audioCtx.createAnalyser(),this.visualize(a)}catch(n){this.onerror(n),this.closeMediaDevices(a)}}this.mediaRecorder.onstop=()=>{this.closeMediaDevices(a);const n=new Blob(s,{type:this.type});this.readerFile(n).then(o=>{this.onstop(o)})},this.mediaRecorder.ondataavailable=n=>{s.push(n.data)},this.mediaRecorder.onerror=()=>{this.onerror()},this.start(),this.onstart()}).catch(a=>{this.log(a,a.name,a.message),this.onerror()})}closeMediaDevices(a){a&&a.getTracks().forEach(s=>{s&&s.stop()})}readerFile(a){const s=new FileReader;return new Promise((n,o)=>{s.onload=l=>{this.log("音频解析完成"),n(l.target.result)},s.onerror=l=>{o(l)},s.readAsDataURL(a)})}stop(){this.mediaRecorder&&this.mediaRecorder.stop(),this.stopDraw=!0}start(){this.mediaRecorder&&this.mediaRecorder.start()}},I={key:0,class:"utry-recorder-container"},W={class:"utry-recorder-container-time"},U={key:0,id:"canvas",width:"120",height:"40"},V={class:"utry-recorder-container-btn"},$=f({__name:"recorder",props:{show:{type:Boolean},showCanvas:{type:Boolean}},emits:["src","update:show"],setup(a,{emit:s}){const n=a,o=60,l=i(null),t=i(""),e=i(0),p=i(null),r=i(!1),D=i(!1),c=i(!1);R(()=>{l.value=new N({option:{audio:!0},canvas:n.showCanvas?"canvas":"",onstop:d=>{if(!D.value&&(t.value=d,!r.value)){const v=o-e.value;s("src",t.value,v),s("update:show",!1)}},onstart:()=>A(),onerror:()=>{alert("浏览器不支持"),s("update:show",!1)}}),c.value=l.value.initMediaDevices(),c.value||(alert("浏览器不支持"),s("update:show",!1))}),q(()=>{c.value&&F()});function F(){clearInterval(p.value),e.value=o,t.value="",D.value=!1,r.value=!1,l.value.initRecording()}function A(){p.value=setInterval(()=>{e.value<=0?(r.value=!0,l.value.stop(),clearInterval(p.value)):e.value--},1e3)}function w(){if(clearInterval(p.value),t.value){const d=o-e.value;s("src",t.value,d),s("update:show",!1)}else l.value.stop()}function E(){p.value&&clearInterval(p.value),D.value=!0,!t.value&&l.value.stop(),s("update:show",!1)}return(d,v)=>c.value?(u(),C("div",I,[y("span",W,x(e.value?`正在录音${e.value}s`:"录音完成"),1),a.showCanvas?(u(),C("canvas",U)):h("",!0),y("div",V,[y("span",{onClick:E},[m(d.$slots,"cancel",{},()=>[g("取消")],!0)]),y("span",{onClick:w},[m(d.$slots,"send",{},()=>[g("发送")],!0)])])])):h("",!0)}});const L=B($,[["__scopeId","data-v-dc7a5bc7"]]),P=_('<h1 id="在线录音" tabindex="-1">在线录音 <a class="header-anchor" href="#在线录音" aria-hidden="true">#</a></h1><p>使用<code>mediarecorder</code>实现纯前端在线录音，仅支持<code>localhost</code>和<code>https</code>环境，需要开启浏览器<code>麦克风权限</code>。</p><h2 id="demo" tabindex="-1">Demo <a class="header-anchor" href="#demo" aria-hidden="true">#</a></h2><p>点击[完成]，将base64数据进行预览播放</p>',4),z=["disabled"],O={class:"recorder-container"},H=y("button",{class:"btn"},"发送",-1),j=y("button",{class:"btn"},"取消",-1),J=["src"],T=_(`<div class="language-vue line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">btn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> @</span><span style="color:#C792EA;">click</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">startRecoreder</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> :</span><span style="color:#C792EA;">disabled</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">showRecorder</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">开始录音</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">recorder-container</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">recorder</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-model</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">show</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">showRecorder</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-if</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">showRecorder</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> @</span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">getRecord</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">showCanvas</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;"> #</span><span style="color:#C792EA;">send</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">btn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">发送</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;"> #</span><span style="color:#C792EA;">cancel</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">btn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">取消</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">recorder</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">audio</span><span style="color:#89DDFF;"> :</span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">controls</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-if</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">audio</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">setup</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">lang</span><span style="color:#A6ACCD;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ref</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> recorder </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./recorder/recorder.vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> showRecorder </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ref</span><span style="color:#A6ACCD;">(</span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;">// 录音</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> src </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ref</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">null</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">startRecoreder</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">showRecorder</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;"> * 获取录音数据</span></span>
<span class="line"><span style="color:#676E95;"> * </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">param</span><span style="color:#676E95;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">}</span><span style="color:#676E95;"> </span><span style="color:#A6ACCD;">base64</span><span style="color:#676E95;"> 录音base64</span></span>
<span class="line"><span style="color:#676E95;"> */</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getRecord</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">base64</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">base64</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">style</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">scoped</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">recorder-container</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">width</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100%</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">height</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">54px</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">style</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h2 id="props" tabindex="-1">Props <a class="header-anchor" href="#props" aria-hidden="true">#</a></h2><table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>v-model:show</td><td>Boolean</td><td>是否显示录音界面，默认false</td></tr><tr><td>showCanvas</td><td>Boolean</td><td>是否显示波形图，非必须｜</td></tr></tbody></table><h2 id="events" tabindex="-1">Events <a class="header-anchor" href="#events" aria-hidden="true">#</a></h2><table><thead><tr><th>名称</th><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>src</td><td>src</td><td>录音base64</td></tr></tbody></table><h2 id="slots" tabindex="-1">Slots <a class="header-anchor" href="#slots" aria-hidden="true">#</a></h2><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>cancel</td><td>取消按钮</td></tr><tr><td>send</td><td>完成按钮</td></tr></tbody></table>`,7),Q=JSON.parse('{"title":"在线录音","description":"","frontmatter":{},"headers":[{"level":2,"title":"Demo","slug":"demo","link":"#demo","children":[]},{"level":2,"title":"Props","slug":"props","link":"#props","children":[]},{"level":2,"title":"Events","slug":"events","link":"#events","children":[]},{"level":2,"title":"Slots","slug":"slots","link":"#slots","children":[]}],"relativePath":"components/在线录音.md"}'),G={name:"components/在线录音.md"},X=f({...G,setup(a){const s=i(!1),n=i(null);function o(){s.value=!0,n.value=""}function l(t){n.value=t}return(t,e)=>{const p=S("ClientOnly");return u(),C("div",null,[P,k(p,null,{default:b(()=>[y("button",{class:"btn",onClick:o,disabled:s.value},"开始录音",8,z),y("div",O,[s.value?(u(),M(L,{key:0,show:s.value,"onUpdate:show":e[0]||(e[0]=r=>s.value=r),onSrc:l,showCanvas:""},{send:b(()=>[H]),cancel:b(()=>[j]),_:1},8,["show"])):h("",!0),n.value?(u(),C("audio",{key:1,src:n.value,controls:""},null,8,J)):h("",!0)])]),_:1}),T])}}});export{Q as __pageData,X as default};
