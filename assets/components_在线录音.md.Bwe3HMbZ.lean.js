import{d as E,p as i,a3 as R,v as _,o as b,c as m,j as d,t as x,e as A,r as f,a as D,_ as S,a2 as g,G as k,w as C,B as M,b as P}from"./chunks/framework.BPuE4Feg.js";const N=class{constructor(a){this.isDebugger=!1,this.mediaRecorder="",this.mediaStreamSource=null,this.audioCtx=null,this.analyser=null,this.stopDraw=!0;const{barWidth:e=3,baseLine:n=3,canvas:l="",color:t="#fff",space:o=3,type:s="audio/mp3",option:p={},onstop:r={},onstart:B={},onerror:c={},isDebugger:y=!1}=a;this.barWidth=e,this.baseLine=n,this.canvas=l,this.color=t,this.space=o,this.type=s,this.option=p,this.onstop=r,this.onstart=B,this.onerror=c,this.isDebugger=y}log(...a){this.isDebugger&&console.log(...a)}visualize(a){this.audioCtx.createMediaStreamSource(a).connect(this.analyser),this.analyser.fftSize=256,this.analyser.connect(this.audioCtx.destination);const n=document.querySelector(this.canvas),{clientWidth:l,clientHeight:t}=n;n.width=l,n.height=t;const o=Math.floor(l/(this.barWidth+this.space)),s=n.getContext("2d"),p=()=>{if(s.clearRect(0,0,l,t),this.stopDraw)return;const r=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(r);let B=0;s.fillStyle=this.color;for(let c=0;c<o;c++){const y=r[c]/256*t||this.baseLine,v=t/2-y/2;s.fillRect(B,v,this.barWidth,y),B+=this.barWidth+this.space}window.requestAnimationFrame(p)};p()}initMediaDevices(){return!!navigator.mediaDevices&&!!navigator.mediaDevices.getUserMedia&&!!window.MediaRecorder}initRecording(){navigator.mediaDevices.getUserMedia(this.option).then(a=>{const e=[];if(this.mediaRecorder=new MediaRecorder(a),this.canvas){this.stopDraw=!1;try{this.audioCtx=new window.AudioContext,this.analyser=this.audioCtx.createAnalyser(),this.visualize(a)}catch(n){this.onerror(n),this.closeMediaDevices(a)}}this.mediaRecorder.onstop=()=>{this.closeMediaDevices(a);const n=new Blob(e,{type:this.type});this.readerFile(n).then(l=>{this.onstop(l)})},this.mediaRecorder.ondataavailable=n=>{e.push(n.data)},this.mediaRecorder.onerror=()=>{this.onerror()},this.start(),this.onstart()}).catch(a=>{this.log(a,a.name,a.message),this.onerror()})}closeMediaDevices(a){a&&a.getTracks().forEach(e=>{e&&e.stop()})}readerFile(a){const e=new FileReader;return new Promise((n,l)=>{e.onload=t=>{this.log("音频解析完成"),n(t.target.result)},e.onerror=t=>{l(t)},e.readAsDataURL(a)})}stop(){this.mediaRecorder&&this.mediaRecorder.stop(),this.stopDraw=!0}start(){this.mediaRecorder&&this.mediaRecorder.start()}},$={key:0,class:"utry-recorder-container"},I={class:"utry-recorder-container-time"},W={key:0,id:"canvas",width:"120",height:"40"},U={class:"utry-recorder-container-btn"},F=60,V=E({__name:"recorder",props:{show:{type:Boolean},showCanvas:{type:Boolean}},emits:["src","update:show"],setup(a,{emit:e}){const n=a,l=e,t=i(null),o=i(""),s=i(0),p=i(null),r=i(!1),B=i(!1),c=i(!1);R(()=>{t.value=new N({option:{audio:!0},canvas:n.showCanvas?"canvas":"",onstop:u=>{if(!B.value&&(o.value=u,!r.value)){const h=F-s.value;l("src",o.value,h),l("update:show",!1)}},onstart:()=>v(),onerror:()=>{alert("浏览器不支持"),l("update:show",!1)}}),c.value=t.value.initMediaDevices(),c.value||(alert("浏览器不支持"),l("update:show",!1))}),_(()=>{c.value&&y()});function y(){clearInterval(p.value),s.value=F,o.value="",B.value=!1,r.value=!1,t.value.initRecording()}function v(){p.value=setInterval(()=>{s.value<=0?(r.value=!0,t.value.stop(),clearInterval(p.value)):s.value--},1e3)}function w(){if(clearInterval(p.value),o.value){const u=F-s.value;l("src",o.value,u),l("update:show",!1)}else t.value.stop()}function q(){p.value&&clearInterval(p.value),B.value=!0,!o.value&&t.value.stop(),l("update:show",!1)}return(u,h)=>c.value?(b(),m("div",$,[d("span",I,x(s.value?`正在录音${s.value}s`:"录音完成"),1),u.showCanvas?(b(),m("canvas",W)):A("",!0),d("div",U,[d("span",{onClick:q},[f(u.$slots,"cancel",{},()=>[h[0]||(h[0]=D("取消"))],!0)]),d("span",{onClick:w},[f(u.$slots,"send",{},()=>[h[1]||(h[1]=D("发送"))],!0)])])])):A("",!0)}}),L=S(V,[["__scopeId","data-v-dc7a5bc7"]]),z=["disabled"],O={class:"recorder-container"},H=["src"],J=JSON.parse('{"title":"在线录音","description":"","frontmatter":{},"headers":[],"relativePath":"components/在线录音.md","filePath":"components/在线录音.md"}'),j={name:"components/在线录音.md"},T=E({...j,setup(a){const e=i(!1),n=i(null);function l(){e.value=!0,n.value=""}function t(o){n.value=o}return(o,s)=>{const p=M("ClientOnly");return b(),m("div",null,[s[3]||(s[3]=g('<h1 id="在线录音" tabindex="-1">在线录音 <a class="header-anchor" href="#在线录音" aria-label="Permalink to &quot;在线录音&quot;">​</a></h1><p>使用<code>mediarecorder</code>实现纯前端在线录音，仅支持<code>localhost</code>和<code>https</code>环境，需要开启浏览器<code>麦克风权限</code>。</p><h2 id="demo" tabindex="-1">Demo <a class="header-anchor" href="#demo" aria-label="Permalink to &quot;Demo&quot;">​</a></h2><p>点击[完成]，将base64数据进行预览播放</p>',4)),k(p,null,{default:C(()=>[d("button",{class:"btn",onClick:l,disabled:e.value},"开始录音",8,z),d("div",O,[e.value?(b(),P(L,{key:0,show:e.value,"onUpdate:show":s[0]||(s[0]=r=>e.value=r),onSrc:t,showCanvas:""},{send:C(()=>s[1]||(s[1]=[d("button",{class:"btn"},"发送",-1)])),cancel:C(()=>s[2]||(s[2]=[d("button",{class:"btn"},"取消",-1)])),_:1},8,["show"])):A("",!0),n.value?(b(),m("audio",{key:1,src:n.value,controls:""},null,8,H)):A("",!0)])]),_:1}),s[4]||(s[4]=g(`<div class="language-vue line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">template</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">button</span><span style="color:#D19A66;"> class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;btn&quot;</span><span style="color:#D19A66;"> @click</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;startRecoreder&quot;</span><span style="color:#D19A66;"> :disabled</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;showRecorder&quot;</span><span style="color:#ABB2BF;">&gt;开始录音&lt;/</span><span style="color:#E06C75;">button</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">div</span><span style="color:#D19A66;"> class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;recorder-container&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">recorder</span><span style="color:#D19A66;"> v-model:show</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;showRecorder&quot;</span><span style="color:#D19A66;"> v-if</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;showRecorder&quot;</span><span style="color:#D19A66;"> @src</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;getRecord&quot;</span><span style="color:#D19A66;"> showCanvas</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">template</span><span style="color:#ABB2BF;"> #</span><span style="color:#D19A66;">send</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">button</span><span style="color:#D19A66;"> class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;btn&quot;</span><span style="color:#ABB2BF;">&gt;发送&lt;/</span><span style="color:#E06C75;">button</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;/</span><span style="color:#E06C75;">template</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">template</span><span style="color:#ABB2BF;"> #</span><span style="color:#D19A66;">cancel</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">button</span><span style="color:#D19A66;"> class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;btn&quot;</span><span style="color:#ABB2BF;">&gt;取消&lt;/</span><span style="color:#E06C75;">button</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;/</span><span style="color:#E06C75;">template</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">recorder</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">audio</span><span style="color:#D19A66;"> :src</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;src&quot;</span><span style="color:#D19A66;"> controls</span><span style="color:#D19A66;"> v-if</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;src&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">audio</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;/</span><span style="color:#E06C75;">div</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">template</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">script</span><span style="color:#D19A66;"> setup</span><span style="color:#D19A66;"> lang</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;ts&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">ref</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &#39;vue&#39;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> recorder</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;./recorder/recorder.vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> showRecorder</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> ref</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">// 录音</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> src</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> ref</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">any</span><span style="color:#ABB2BF;">&gt;(</span><span style="color:#D19A66;">null</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> startRecoreder</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#E5C07B;">  showRecorder</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> true</span></span>
<span class="line"><span style="color:#E5C07B;">  src</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> * 获取录音数据</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> * </span><span style="color:#C678DD;font-style:italic;">@param</span><span style="color:#E5C07B;font-style:italic;"> {string}</span><span style="color:#E06C75;font-style:italic;"> base64</span><span style="color:#7F848E;font-style:italic;"> 录音base64</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> getRecord</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">base64</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">string</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">  src</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> base64</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">script</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">style</span><span style="color:#D19A66;"> scoped</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#D19A66;">.recorder-container</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  width: </span><span style="color:#D19A66;">100</span><span style="color:#E06C75;">%</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  height: </span><span style="color:#D19A66;">54</span><span style="color:#E06C75;">px</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">style</span><span style="color:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h2 id="props" tabindex="-1">Props <a class="header-anchor" href="#props" aria-label="Permalink to &quot;Props&quot;">​</a></h2><table tabindex="0"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>v-model:show</td><td>Boolean</td><td>是否显示录音界面，默认false</td></tr><tr><td>showCanvas</td><td>Boolean</td><td>是否显示波形图，非必须｜</td></tr></tbody></table><h2 id="events" tabindex="-1">Events <a class="header-anchor" href="#events" aria-label="Permalink to &quot;Events&quot;">​</a></h2><table tabindex="0"><thead><tr><th>名称</th><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>src</td><td>src</td><td>录音base64</td></tr></tbody></table><h2 id="slots" tabindex="-1">Slots <a class="header-anchor" href="#slots" aria-label="Permalink to &quot;Slots&quot;">​</a></h2><table tabindex="0"><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>cancel</td><td>取消按钮</td></tr><tr><td>send</td><td>完成按钮</td></tr></tbody></table>`,7))])}}});export{J as __pageData,T as default};
