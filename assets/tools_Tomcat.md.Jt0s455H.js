import{_ as a,c as s,o as n,R as e}from"./chunks/framework.zaQn3Cfr.js";const p="/assets/tomcat.0dEpnmHU.png",v=JSON.parse('{"title":"Tomcat入门","description":"","frontmatter":{},"headers":[],"relativePath":"tools/Tomcat.md","filePath":"tools/Tomcat.md"}'),l={name:"tools/Tomcat.md"},o=e(`<h1 id="tomcat入门" tabindex="-1">Tomcat入门 <a class="header-anchor" href="#tomcat入门" aria-label="Permalink to &quot;Tomcat入门&quot;">​</a></h1><h2 id="安装java" tabindex="-1">安装Java <a class="header-anchor" href="#安装java" aria-label="Permalink to &quot;安装Java&quot;">​</a></h2><blockquote><p>JDK20来了，但是据说大部分情况下还是用的8</p></blockquote><p>下载 Java SE Development Kit 8u381</p><p><a href="https://www.oracle.com/cn/java/technologies/downloads/#java8" target="_blank" rel="noreferrer">https://www.oracle.com/cn/java/technologies/downloads/#java8</a></p><h2 id="安装tomcat" tabindex="-1">安装Tomcat <a class="header-anchor" href="#安装tomcat" aria-label="Permalink to &quot;安装Tomcat&quot;">​</a></h2><p>官方下载</p><p><a href="https://tomcat.apache.org/download-90.cgi" target="_blank" rel="noreferrer">https://tomcat.apache.org/download-90.cgi</a></p><ul><li><p>2023-08-15 Tomcat 9.0.79 Released</p><ul><li>The Apache Tomcat Project is proud to announce the release of version 9.0.79 of Apache Tomcat. This release implements specifications that are part of the Java EE 8 platform.</li></ul></li></ul><p>这个版本就是搭配jdk1.8使用</p><p>下载Core到zip包就可以了</p><p><a href="https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.79/bin/apache-tomcat-9.0.79.zip" target="_blank" rel="noreferrer">https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.79/bin/apache-tomcat-9.0.79.zip</a></p><p>zip解压后建议文件夹改名<code>Tomcat</code>，并放到自定义目录，如<code>/usr/local</code></p><h2 id="目录结构" tabindex="-1">目录结构 <a class="header-anchor" href="#目录结构" aria-label="Permalink to &quot;目录结构&quot;">​</a></h2><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>├── bin                     系统命令，如启动，关闭</span></span>
<span class="line"><span>├── conf                    配置文件</span></span>
<span class="line"><span>│   ├── server.xml          服务器信息</span></span>
<span class="line"><span>│   ├── tomcat-users.xml    用户信息</span></span>
<span class="line"><span>│   └── web.xml             支持的文件类型</span></span>
<span class="line"><span>├── lib                     运行需要加载的jar包</span></span>
<span class="line"><span>├── logs                    日志文件</span></span>
<span class="line"><span>├── temp                    临时文件</span></span>
<span class="line"><span>├── webapps                 应用程序，默认5个</span></span>
<span class="line"><span>│   ├── ROOT</span></span>
<span class="line"><span>│   ├── docs</span></span>
<span class="line"><span>│   ├── examples</span></span>
<span class="line"><span>│   ├── host-manager</span></span>
<span class="line"><span>│   └── manager</span></span>
<span class="line"><span>└── work                    运行时的编译后的文件</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="修改默认端口号" tabindex="-1">修改默认端口号 <a class="header-anchor" href="#修改默认端口号" aria-label="Permalink to &quot;修改默认端口号&quot;">​</a></h2><p>因为Tomcat默认端口号是8080，如果本地安装了nginx，端口号冲突了，建议修改端口号后再启动服务</p><p>打开文件<code>conf/server.xml</code>，查找<code>8080</code>，修改为<code>9090</code></p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>    &lt;Connector port=&quot;9090&quot; protocol=&quot;HTTP/1.1&quot;</span></span>
<span class="line"><span>               connectionTimeout=&quot;20000&quot;</span></span>
<span class="line"><span>               redirectPort=&quot;8443&quot;</span></span>
<span class="line"><span>               maxParameterCount=&quot;1000&quot;</span></span>
<span class="line"><span>               /&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="启动服务" tabindex="-1">启动服务 <a class="header-anchor" href="#启动服务" aria-label="Permalink to &quot;启动服务&quot;">​</a></h2><blockquote><p>/usr/local/Tomcat为Tomcat所在目录</p></blockquote><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">sh</span><span style="color:#98C379;"> /usr/local/Tomcat/bin/startup.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>执行成功后返回如下信息</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>Using CATALINA_BASE:   /usr/local/Tomcat</span></span>
<span class="line"><span>Using CATALINA_HOME:   /usr/local/Tomcat</span></span>
<span class="line"><span>Using CATALINA_TMPDIR: /usr/local/Tomcat/temp</span></span>
<span class="line"><span>Using JRE_HOME:        /Library/Java/JavaVirtualMachines/jdk1.8.0_333.jdk/Contents/Home</span></span>
<span class="line"><span>Using CLASSPATH:       /usr/local/Tomcat/bin/bootstrap.jar:/usr/local/Tomcat/bin/tomcat-juli.jar</span></span>
<span class="line"><span>Using CATALINA_OPTS:</span></span>
<span class="line"><span>Tomcat started.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="验证服务" tabindex="-1">验证服务 <a class="header-anchor" href="#验证服务" aria-label="Permalink to &quot;验证服务&quot;">​</a></h2><p>访问<code>http://localhost:9090/</code>，出现默认页面说明安装成功</p><p><img src="`+p+`" alt="安装成功"></p><h2 id="重启服务" tabindex="-1">重启服务 <a class="header-anchor" href="#重启服务" aria-label="Permalink to &quot;重启服务&quot;">​</a></h2><p>简单来说分2步</p><ul><li>关闭服务 <code>sh /usr/local/Tomcat/bin/shutdown.sh</code></li><li>启动服务 <code>sh /usr/local/Tomcat/bin/startup.sh</code></li></ul><h2 id="增加应用程序" tabindex="-1">增加应用程序 <a class="header-anchor" href="#增加应用程序" aria-label="Permalink to &quot;增加应用程序&quot;">​</a></h2><h3 id="war包" tabindex="-1">war包 <a class="header-anchor" href="#war包" aria-label="Permalink to &quot;war包&quot;">​</a></h3><p>后端编译出来的<code>api.war</code>拷贝到webapps目录，tomcat会自动解压</p><p>访问路径<code>http://localhost:9090/api</code></p><h3 id="静态网站" tabindex="-1">静态网站 <a class="header-anchor" href="#静态网站" aria-label="Permalink to &quot;静态网站&quot;">​</a></h3><p>vue编译出来的<code>dist</code>拷贝到webapps目录</p><p>访问路径<code>http://localhost:9090/dist</code></p><h2 id="更新应用程序" tabindex="-1">更新应用程序 <a class="header-anchor" href="#更新应用程序" aria-label="Permalink to &quot;更新应用程序&quot;">​</a></h2><p>同名war包更新，或配置文件更新，需要重启Tomcat生效</p><p>如java配置文件相对路径<code>/WEB-INF/classes/config/application.yml</code></p><h2 id="可视化管理后台" tabindex="-1">可视化管理后台 <a class="header-anchor" href="#可视化管理后台" aria-label="Permalink to &quot;可视化管理后台&quot;">​</a></h2><p>需要设置用户名和密码,修改conf/tomcat-users.xml，查找<code>&lt;tomcat-users</code></p><p>增加用户信息</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>&lt;role rolename=&quot;manager-gui&quot;/&gt;</span></span>
<span class="line"><span>&lt;user username=&quot;tomcat&quot; password=&quot;s3cret&quot; roles=&quot;manager-gui&quot;/&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>可以通过网页管理应用程序</p><p>访问路径<code>http://localhost:9090/manager/html</code></p><h2 id="日志切割方案" tabindex="-1">日志切割方案 <a class="header-anchor" href="#日志切割方案" aria-label="Permalink to &quot;日志切割方案&quot;">​</a></h2><blockquote><p>catalina.out文件会随着系统运行越来越大，官方未提供方案，此为常见的处理方案</p></blockquote><ul><li>新建切割日志脚本</li><li>每天定时执行脚本</li><li>手动按需清理文件</li></ul><p>在tomcat目录下新建<code>catLog.sh</code></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">DATE</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">\`</span><span style="color:#61AFEF;">date</span><span style="color:#98C379;"> &quot;+%Y-%m-%d&quot;\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">cp</span><span style="color:#98C379;"> ./logs/catalina.out</span><span style="color:#98C379;"> ./logs/catalina.out.</span><span style="color:#E06C75;">$DATE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">wait</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">echo</span><span style="color:#98C379;"> &quot; &quot;</span><span style="color:#ABB2BF;"> &gt; </span><span style="color:#98C379;">./logs/catalina.out</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>增加一条定时任务</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">crontab</span><span style="color:#D19A66;"> -e</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>新增以下行</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>0 0 * * * sh /usr/local/Tomcat/catLog.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>保存并退出后查看存在的定时任务</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">crontab</span><span style="color:#D19A66;"> -l</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>确认后即可实现每天0点对<code>catalina.out</code>文件按照日期切割为新的日志文件，并清空原有文件，可按需手动清除指定日期的日志文件</p>`,58),c=[o];function r(t,i,d,u,b,m){return n(),s("div",null,c)}const g=a(l,[["render",r]]);export{v as __pageData,g as default};
