import{d as _,h as i,a5 as q,j as R,o as u,c as C,k as D,t as B,e as h,r as f,a as g,_ as x,K as S,O as k,w as A,X as E,b as M}from"./chunks/framework.65f621ee.js";const P=class{constructor(a){this.isDebugger=!1,this.mediaRecorder="",this.mediaStreamSource=null,this.audioCtx=null,this.analyser=null,this.stopDraw=!0;const{barWidth:s=3,baseLine:n=3,canvas:e="",color:l="#fff",space:t=3,type:o="audio/mp3",option:p={},onstop:r={},onstart:c={},onerror:y={},isDebugger:d=!1}=a;this.barWidth=s,this.baseLine=n,this.canvas=e,this.color=l,this.space=t,this.type=o,this.option=p,this.onstop=r,this.onstart=c,this.onerror=y,this.isDebugger=d}log(...a){this.isDebugger&&console.log(...a)}visualize(a){this.audioCtx.createMediaStreamSource(a).connect(this.analyser),this.analyser.fftSize=256,this.analyser.connect(this.audioCtx.destination);const n=document.querySelector(this.canvas),{clientWidth:e,clientHeight:l}=n;n.width=e,n.height=l;const t=Math.floor(e/(this.barWidth+this.space)),o=n.getContext("2d"),p=()=>{if(o.clearRect(0,0,e,l),this.stopDraw)return;const r=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(r);let c=0;o.fillStyle=this.color;for(let y=0;y<t;y++){const d=r[y]/256*l||this.baseLine,b=l/2-d/2;o.fillRect(c,b,this.barWidth,d),c+=this.barWidth+this.space}window.requestAnimationFrame(p)};p()}initMediaDevices(){return!!navigator.mediaDevices&&!!navigator.mediaDevices.getUserMedia&&!!window.MediaRecorder}initRecording(){navigator.mediaDevices.getUserMedia(this.option).then(a=>{const s=[];if(this.mediaRecorder=new MediaRecorder(a),this.canvas){this.stopDraw=!1;try{this.audioCtx=new window.AudioContext,this.analyser=this.audioCtx.createAnalyser(),this.visualize(a)}catch(n){this.onerror(n),this.closeMediaDevices(a)}}this.mediaRecorder.onstop=()=>{this.closeMediaDevices(a);const n=new Blob(s,{type:this.type});this.readerFile(n).then(e=>{this.onstop(e)})},this.mediaRecorder.ondataavailable=n=>{s.push(n.data)},this.mediaRecorder.onerror=()=>{this.onerror()},this.start(),this.onstart()}).catch(a=>{this.log(a,a.name,a.message),this.onerror()})}closeMediaDevices(a){a&&a.getTracks().forEach(s=>{s&&s.stop()})}readerFile(a){const s=new FileReader;return new Promise((n,e)=>{s.onload=l=>{this.log("音频解析完成"),n(l.target.result)},s.onerror=l=>{e(l)},s.readAsDataURL(a)})}stop(){this.mediaRecorder&&this.mediaRecorder.stop(),this.stopDraw=!0}start(){this.mediaRecorder&&this.mediaRecorder.start()}},N={key:0,class:"utry-recorder-container"},I={class:"utry-recorder-container-time"},W={key:0,id:"canvas",width:"120",height:"40"},U={class:"utry-recorder-container-btn"},m=60,V=_({__name:"recorder",props:{show:{type:Boolean},showCanvas:{type:Boolean}},emits:["src","update:show"],setup(a,{emit:s}){const n=a,e=i(null),l=i(""),t=i(0),o=i(null),p=i(!1),r=i(!1),c=i(!1);q(()=>{e.value=new P({option:{audio:!0},canvas:n.showCanvas?"canvas":"",onstop:F=>{if(!r.value&&(l.value=F,!p.value)){const v=m-t.value;s("src",l.value,v),s("update:show",!1)}},onstart:()=>d(),onerror:()=>{alert("浏览器不支持"),s("update:show",!1)}}),c.value=e.value.initMediaDevices(),c.value||(alert("浏览器不支持"),s("update:show",!1))}),R(()=>{c.value&&y()});function y(){clearInterval(o.value),t.value=m,l.value="",r.value=!1,p.value=!1,e.value.initRecording()}function d(){o.value=setInterval(()=>{t.value<=0?(p.value=!0,e.value.stop(),clearInterval(o.value)):t.value--},1e3)}function b(){if(clearInterval(o.value),l.value){const F=m-t.value;s("src",l.value,F),s("update:show",!1)}else e.value.stop()}function w(){o.value&&clearInterval(o.value),r.value=!0,!l.value&&e.value.stop(),s("update:show",!1)}return(F,v)=>c.value?(u(),C("div",N,[D("span",I,B(t.value?`正在录音${t.value}s`:"录音完成"),1),F.showCanvas?(u(),C("canvas",W)):h("",!0),D("div",U,[D("span",{onClick:w},[f(F.$slots,"cancel",{},()=>[g("取消")],!0)]),D("span",{onClick:b},[f(F.$slots,"send",{},()=>[g("发送")],!0)])])])):h("",!0)}});const $=x(V,[["__scopeId","data-v-dc7a5bc7"]]),L=E('<h1 id="在线录音" tabindex="-1">在线录音 <a class="header-anchor" href="#在线录音" aria-label="Permalink to &quot;在线录音&quot;">​</a></h1><p>使用<code>mediarecorder</code>实现纯前端在线录音，仅支持<code>localhost</code>和<code>https</code>环境，需要开启浏览器<code>麦克风权限</code>。</p><h2 id="demo" tabindex="-1">Demo <a class="header-anchor" href="#demo" aria-label="Permalink to &quot;Demo&quot;">​</a></h2><p>点击[完成]，将base64数据进行预览播放</p>',4),O=["disabled"],z={class:"recorder-container"},H=D("button",{class:"btn"},"发送",-1),j=D("button",{class:"btn"},"取消",-1),J=["src"],K=E(`<div class="language-vue line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">btn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">@click</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">startRecoreder</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">:disabled</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">showRecorder</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">开始录音</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">recorder-container</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">recorder</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-model:show</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">showRecorder</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-if</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">showRecorder</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">@src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">getRecord</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">showCanvas</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">#</span><span style="color:#C792EA;">send</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">btn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">发送</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">#</span><span style="color:#C792EA;">cancel</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">btn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">取消</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">recorder</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">audio</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">:src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">controls</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-if</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">audio</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">setup</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ref</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> recorder </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./recorder/recorder.vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> showRecorder </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ref</span><span style="color:#A6ACCD;">(</span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// 录音</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> src </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ref</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">null</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">startRecoreder</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">showRecorder</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 获取录音数据</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#FFCB6B;font-style:italic;">string</span><span style="color:#89DDFF;font-style:italic;">}</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">base64</span><span style="color:#676E95;font-style:italic;"> 录音base64</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getRecord</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">base64</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">base64</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">style</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">scoped</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">recorder-container</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">width</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100%</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">height</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">54px</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">style</span><span style="color:#89DDFF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h2 id="props" tabindex="-1">Props <a class="header-anchor" href="#props" aria-label="Permalink to &quot;Props&quot;">​</a></h2><table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>v-model:show</td><td>Boolean</td><td>是否显示录音界面，默认false</td></tr><tr><td>showCanvas</td><td>Boolean</td><td>是否显示波形图，非必须｜</td></tr></tbody></table><h2 id="events" tabindex="-1">Events <a class="header-anchor" href="#events" aria-label="Permalink to &quot;Events&quot;">​</a></h2><table><thead><tr><th>名称</th><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>src</td><td>src</td><td>录音base64</td></tr></tbody></table><h2 id="slots" tabindex="-1">Slots <a class="header-anchor" href="#slots" aria-label="Permalink to &quot;Slots&quot;">​</a></h2><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>cancel</td><td>取消按钮</td></tr><tr><td>send</td><td>完成按钮</td></tr></tbody></table>`,7),G=JSON.parse('{"title":"在线录音","description":"","frontmatter":{},"headers":[],"relativePath":"components/在线录音.md","filePath":"components/在线录音.md"}'),T={name:"components/在线录音.md"},Q=_({...T,setup(a){const s=i(!1),n=i(null);function e(){s.value=!0,n.value=""}function l(t){n.value=t}return(t,o)=>{const p=S("ClientOnly");return u(),C("div",null,[L,k(p,null,{default:A(()=>[D("button",{class:"btn",onClick:e,disabled:s.value},"开始录音",8,O),D("div",z,[s.value?(u(),M($,{key:0,show:s.value,"onUpdate:show":o[0]||(o[0]=r=>s.value=r),onSrc:l,showCanvas:""},{send:A(()=>[H]),cancel:A(()=>[j]),_:1},8,["show"])):h("",!0),n.value?(u(),C("audio",{key:1,src:n.value,controls:""},null,8,J)):h("",!0)])]),_:1}),K])}}});export{G as __pageData,Q as default};
