import{g as P,d as w,p as m,v as S,o as b,c as f,j as r,F as j,C,k as v,a as _,n as y,t as T,N as x,_ as D,G as k,w as B,B as R}from"./chunks/framework.BPuE4Feg.js";const F=class{constructor(){this.type="stroke",this.width=0,this.height=0,this.arr=[],this.action="pen",this.canvasObj=null}initCanvas(t,a,s){const e=document.getElementById(t);this.canvasObj=e.getContext("2d",{willReadFrequently:!0}),this.width=this.canvasObj.canvas.width,this.height=this.canvasObj.canvas.height,a&&s&&(this.changeStyle({color:a,lineWidth:s}),e.onmousedown=n=>{if(n.button!==0)return;const c=n.offsetX,l=n.offsetY;this.canvasObj.beginPath(),this.canvasObj.moveTo(n.offsetX,n.offsetY),e.onmousemove=h=>{["pen","eraser"].includes(this.action)&&this[this.action](h.offsetX,h.offsetY),e.style.cursor=`url(${P("/ico/pen.ico")}), pointer`},document.onmouseup=h=>{["rect","circle","line","poly"].includes(this.action)&&this[this.action](c,l,h.offsetX,h.offsetY),e.onmousemove=null,document.onmouseup=null,this.saveStep()}})}changeStyle({color:t,lineWidth:a,action:s=this.action}){this.canvasObj.strokeStyle=t,this.canvasObj.fillStyle=t,this.canvasObj.lineWidth=a,this.action=s}pen(t,a){this.canvasObj.save(),this.canvasObj.lineCap="round",this.canvasObj.lineTo(t,a),this.canvasObj.stroke(),this.canvasObj.restore()}eraser(t,a){this.canvasObj.lineCap="round",this.canvasObj.clearRect(t-5,a-5,20,20)}changeType(t){this.type=t}rect(t,a,s,e){this.canvasObj.beginPath(),this.canvasObj.rect(t,a,s-t,e-a),this.type=="stroke"?this.canvasObj.stroke():this.type=="fill"&&this.canvasObj.fill(),this.canvasObj.restore()}circle(t,a,s,e){const n=Math.sqrt(Math.pow(t-s,2)+Math.pow(a-e,2));this.canvasObj.beginPath(),this.canvasObj.arc(t,a,n,0,2*Math.PI),this.type=="stroke"?this.canvasObj.stroke():this.type=="fill"&&this.canvasObj.fill(),this.canvasObj.restore()}line(t,a,s,e){this.canvasObj.beginPath(),this.canvasObj.moveTo(t,a),this.canvasObj.lineTo(s,e),this.canvasObj.stroke()}poly(t,a,s,e,n=3){const c=Math.sqrt(Math.pow(t-s,2)+Math.pow(a-e,2));this.canvasObj.save(),this.canvasObj.translate(t,a),this.canvasObj.rotate(Math.PI/2);var l=c*Math.cos(Math.PI/n),h=c*Math.sin(Math.PI/n);this.canvasObj.beginPath(),this.canvasObj.lineCap="round",this.canvasObj.moveTo(l,h);for(var u=0;u<=n;u++)this.canvasObj.rotate(Math.PI*2/n),this.canvasObj.lineTo(l,-h);this.type=="stroke"?this.canvasObj.stroke():this.type=="fill"&&this.canvasObj.fill(),this.canvasObj.restore()}clearCanvas(){this.arr=[],this.canvasObj.clearRect(0,0,this.width,this.height)}back(){this.arr.pop(),this.canvasObj.clearRect(0,0,this.width,this.height),this.arr.length&&this.canvasObj.putImageData(this.arr[this.arr.length-1],0,0,0,0,this.width,this.height)}saveStep(){this.arr.push(this.canvasObj.getImageData(0,0,this.width,this.height))}drawImage(t,a=0,s=0,e=this.width,n=this.height){this.canvasObj.drawImage(t,a,s,e,n)}},N={class:"toolList"},$=["onClick"],L={class:"toolList"},X=["onClick"],Y=w({__name:"demo",setup(t){const a=["pen","rect","circle","line","poly","eraser"],s="image/jpg,image/jpeg,image/png,image/gif".split(","),e=["#333","red","green","orange","blue","yellow"],n=m();let c=m(null),l=m({action:"pen",color:"#333",lineWidth:3});function h(d,i){l.value[d]=i,c.changeStyle(l.value)}function u(){n.value.click()}function I(d){const i=d.target.files[0];if(!i)return;const{name:o,type:g}=i;if(i&&s.includes(g)){const p=new Image,O=new FileReader;O.readAsDataURL(i),O.onloadend=M=>{p.src=M.target.result,p.onload=()=>{c.drawImage(p,0,0,500,p.height/p.width*500),c.saveStep()}}}else alert(`文件仅支持图片格式, '${o}' 不符合要求`);d.target.value=null}return S(()=>{c=new F,c.initCanvas("boradCanvas",l.value.color,l.value.lineWidth)}),(d,i)=>(b(),f(j,null,[r("div",N,[(b(),f(j,null,C(a,o=>r("div",{class:y({active:o===v(l).action}),onClick:g=>h("action",o),key:o},T(o),11,$)),64)),r("div",{onClick:i[0]||(i[0]=(...o)=>v(c).back&&v(c).back(...o))},"Undo"),r("div",{onClick:i[1]||(i[1]=(...o)=>v(c).clearCanvas&&v(c).clearCanvas(...o))},"Clean"),r("div",{class:"addImg",onClick:u},[i[2]||(i[2]=_("addImg ")),r("input",{type:"file",accept:"image/*",ref_key:"file",ref:n,onChange:I},null,544)])]),r("div",L,[(b(),f(j,null,C(e,o=>r("div",{key:o,onClick:g=>h("color",o),style:x({background:o}),class:y({active:o===v(l).color})},null,14,X)),64))]),i[3]||(i[3]=r("canvas",{width:"500",height:"500",id:"boradCanvas"},null,-1))],64))}}),q=D(Y,[["__scopeId","data-v-edd2cb85"]]),E=JSON.parse('{"title":"Canvas画板","description":"","frontmatter":{},"headers":[],"relativePath":"components/Canvas.md","filePath":"components/Canvas.md"}'),V={name:"components/Canvas.md"},U=w({...V,setup(t){return(a,s)=>{const e=R("ClientOnly");return b(),f("div",null,[s[0]||(s[0]=r("h1",{id:"canvas画板",tabindex:"-1"},[_("Canvas画板 "),r("a",{class:"header-anchor",href:"#canvas画板","aria-label":'Permalink to "Canvas画板"'},"​")],-1)),k(e,null,{default:B(()=>[k(q)]),_:1})])}}});export{E as __pageData,U as default};
