var P=Object.defineProperty;var T=(t,a,s)=>a in t?P(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s;var v=(t,a,s)=>(T(t,typeof a!="symbol"?a+"":a,s),s);import{f as x,d as k,h as j,j as D,o as f,c as g,k as r,I as O,J as y,l as d,a as I,n as C,t as R,U as $,p as B,m as L,_ as F,H as N,L as w,w as X}from"./chunks/framework.5781d47f.js";const Y=class{constructor(){v(this,"type");v(this,"width");v(this,"height");v(this,"arr");v(this,"action");v(this,"canvasObj");this.type="stroke",this.width=0,this.height=0,this.arr=[],this.action="pen",this.canvasObj=null}initCanvas(t,a,s){const e=document.getElementById(t);this.canvasObj=e.getContext("2d",{willReadFrequently:!0}),this.width=this.canvasObj.canvas.width,this.height=this.canvasObj.canvas.height,a&&s&&(this.changeStyle({color:a,lineWidth:s}),e.onmousedown=n=>{if(n.button!==0)return;const o=n.offsetX,c=n.offsetY;this.canvasObj.beginPath(),this.canvasObj.moveTo(n.offsetX,n.offsetY),e.onmousemove=h=>{["pen","eraser"].includes(this.action)&&this[this.action](h.offsetX,h.offsetY),e.style.cursor=`url(${x("/ico/pen.ico")}), pointer`},document.onmouseup=h=>{["rect","circle","line","poly"].includes(this.action)&&this[this.action](o,c,h.offsetX,h.offsetY),e.onmousemove=null,document.onmouseup=null,this.saveStep()}})}changeStyle({color:t,lineWidth:a,action:s=this.action}){this.canvasObj.strokeStyle=t,this.canvasObj.fillStyle=t,this.canvasObj.lineWidth=a,this.action=s}pen(t,a){this.canvasObj.save(),this.canvasObj.lineCap="round",this.canvasObj.lineTo(t,a),this.canvasObj.stroke(),this.canvasObj.restore()}eraser(t,a){this.canvasObj.lineCap="round",this.canvasObj.clearRect(t-5,a-5,20,20)}changeType(t){this.type=t}rect(t,a,s,e){this.canvasObj.beginPath(),this.canvasObj.rect(t,a,s-t,e-a),this.type=="stroke"?this.canvasObj.stroke():this.type=="fill"&&this.canvasObj.fill(),this.canvasObj.restore()}circle(t,a,s,e){const n=Math.sqrt(Math.pow(t-s,2)+Math.pow(a-e,2));this.canvasObj.beginPath(),this.canvasObj.arc(t,a,n,0,2*Math.PI),this.type=="stroke"?this.canvasObj.stroke():this.type=="fill"&&this.canvasObj.fill(),this.canvasObj.restore()}line(t,a,s,e){this.canvasObj.beginPath(),this.canvasObj.moveTo(t,a),this.canvasObj.lineTo(s,e),this.canvasObj.stroke()}poly(t,a,s,e,n=3){const o=Math.sqrt(Math.pow(t-s,2)+Math.pow(a-e,2));this.canvasObj.save(),this.canvasObj.translate(t,a),this.canvasObj.rotate(Math.PI/2);var c=o*Math.cos(Math.PI/n),h=o*Math.sin(Math.PI/n);this.canvasObj.beginPath(),this.canvasObj.lineCap="round",this.canvasObj.moveTo(c,h);for(var b=0;b<=n;b++)this.canvasObj.rotate(Math.PI*2/n),this.canvasObj.lineTo(c,-h);this.type=="stroke"?this.canvasObj.stroke():this.type=="fill"&&this.canvasObj.fill(),this.canvasObj.restore()}clearCanvas(){this.arr=[],this.canvasObj.clearRect(0,0,this.width,this.height)}back(){this.arr.pop(),this.canvasObj.clearRect(0,0,this.width,this.height),this.arr.length&&this.canvasObj.putImageData(this.arr[this.arr.length-1],0,0,0,0,this.width,this.height)}saveStep(){this.arr.push(this.canvasObj.getImageData(0,0,this.width,this.height))}drawImage(t,a=0,s=0,e=this.width,n=this.height){this.canvasObj.drawImage(t,a,s,e,n)}},q=t=>(B("data-v-edd2cb85"),t=t(),L(),t),U={class:"toolList"},V=["onClick"],z={class:"toolList"},E=["onClick"],J=q(()=>r("canvas",{width:"500",height:"500",id:"boradCanvas"},null,-1)),W=k({__name:"demo",setup(t){const a=["pen","rect","circle","line","poly","eraser"],s="image/jpg,image/jpeg,image/png,image/gif".split(","),e=["#333","red","green","orange","blue","yellow"],n=j();let o=j(null),c=j({action:"pen",color:"#333",lineWidth:3});function h(p,l){c.value[p]=l,o.changeStyle(c.value)}function b(){n.value.click()}function S(p){const l=p.target.files[0];if(!l)return;const{name:i,type:m}=l;if(l&&s.includes(m)){const u=new Image,_=new FileReader;_.readAsDataURL(l),_.onloadend=M=>{u.src=M.target.result,u.onload=()=>{o.drawImage(u,0,0,500,u.height/u.width*500),o.saveStep()}}}else alert(`文件仅支持图片格式, '${i}' 不符合要求`);p.target.value=null}return D(()=>{o=new Y,o.initCanvas("boradCanvas",c.value.color,c.value.lineWidth)}),(p,l)=>(f(),g(O,null,[r("div",U,[(f(),g(O,null,y(a,i=>r("div",{class:C({active:i===d(c).action}),onClick:m=>h("action",i),key:i},R(i),11,V)),64)),r("div",{onClick:l[0]||(l[0]=(...i)=>d(o).back&&d(o).back(...i))},"Undo"),r("div",{onClick:l[1]||(l[1]=(...i)=>d(o).clearCanvas&&d(o).clearCanvas(...i))},"Clean"),r("div",{class:"addImg",onClick:b},[I("addImg "),r("input",{type:"file",accept:"image/*",ref_key:"file",ref:n,onChange:S},null,544)])]),r("div",z,[(f(),g(O,null,y(e,i=>r("div",{key:i,onClick:m=>h("color",i),style:$({background:i}),class:C({active:i===d(c).color})},null,14,E)),64))]),J],64))}});const A=F(W,[["__scopeId","data-v-edd2cb85"]]),H=r("h1",{id:"canvas画板",tabindex:"-1"},[I("Canvas画板 "),r("a",{class:"header-anchor",href:"#canvas画板","aria-label":'Permalink to "Canvas画板"'},"​")],-1),Z=JSON.parse('{"title":"Canvas画板","description":"","frontmatter":{},"headers":[],"relativePath":"components/Canvas.md","filePath":"components/Canvas.md"}'),G={name:"components/Canvas.md"},tt=k({...G,setup(t){return(a,s)=>{const e=N("ClientOnly");return f(),g("div",null,[H,w(e,null,{default:X(()=>[w(A)]),_:1})])}}});export{Z as __pageData,tt as default};
